const e=React.createElement,getCSS=e=>e?"\n  :root,\n  body,\n    html {\n      box-sizing: border-box;\n    }\n    #main-table\n    {\n      margin: 0;\n      padding: 0;\n      outline: none;\n      font-size: 100%;\n      vertical-align: baseline;\n      background: transparent;\n      white-space: nowrap;\n    }\n    #main-table tr {\n      background: transparent;\n    }\n    #main-table th {\n      white-space: pre-line;\n    }\n    #main-table tr:not(:first-child) {\n      border-right: 2px solid firebrick;\n      border-left: 2px solid firebrick;\n    }\n    #main-table tr:nth-last-child(1) {\n      border-bottom: 2px solid firebrick;\n    }\n    .table-top-border {\n      border-top: 2px solid firebrick;\n    }\n    .p-solve {\n      color: firebrick;\n    }\n    .monospace {\n      font-family: monospace;\n      font-size: 0.9rem;\n    }\n    .spoo-dot {\n      height: 0.5rem;\n      width: 0.5rem;\n      background-color: transparent;\n      border-radius: 50%;\n      display: inline-block;\n      margin-right: 0.2rem;\n    }\n    .late-window .spoo-dot {\n      background-color: rgb(184, 29, 19, 100%);\n    }\n    .current-window .spoo-dot {\n      background-color: rgb(239, 183, 0, 100%);\n    }\n    .next-window .spoo-dot {\n      background-color: rgb(0, 132, 80, 100%);\n    }\n  ":"\n    :root,\n    body,\n    html {\n      box-sizing: border-box;\n    }\n    #main-table\n    {\n      margin: 0;\n      padding: 0;\n      outline: none;\n      font-size: 100%;\n      vertical-align: baseline;\n      background: transparent;\n      border-collapse: collapse;\n      text-align: center;\n      white-space: nowrap;\n    }\n    #main-table tr {\n      background: transparent;\n    }\n    #main-table th {\n      white-space: pre-line;\n    }\n    #main-table tr:not(:first-child) {\n      border-right: 2px solid firebrick;\n      border-left: 2px solid firebrick;\n    }\n    #main-table tr:nth-last-child(1) {\n      border-bottom: 2px solid firebrick;\n    }\n    .table-top-border {\n      border-top: 2px solid firebrick;\n    }\n    .p-solve {\n      color: firebrick;\n    }\n    .monospace {\n      font-family: monospace;\n      font-size: 0.9rem;\n    }\n    .spoo-dot {\n      height: 0.5rem;\n      width: 0.5rem;\n      background-color: transparent;\n      border-radius: 50%;\n      display: inline-block;\n      margin-right: 0.2rem;\n    }\n    .late-window .spoo-dot {\n      background-color: rgb(184, 29, 19, 100%);\n    }\n    .current-window .spoo-dot {\n      background-color: rgb(239, 183, 0, 100%);\n    }\n    .next-window .spoo-dot {\n      background-color: rgb(0, 132, 80, 100%);\n    }\n  ",getActions=e=>{const n=[...e.querySelectorAll("tbody > tr")];return n.shift(),n.map((e=>[...e.querySelectorAll("td")].map((e=>e.textContent.trim()))))},TableHeader=({titles:n})=>{const t=n.map((n=>e("th",{className:"a-text-center",key:n},n)));return e("tr",null,t)},getPackageInfo=async(e,n)=>{const t=n?"div.a-row:nth-child(6)":"table:nth-child(6) tr:nth-child(2)",r=n?"div.a-row:nth-child(10)":"tr:nth-child(6)",o=n?"div.a-row:nth-child(12)":"tr:nth-child(8)",a=n?"div.a-row:nth-child(2)":"tr:nth-child(2)",i=/\d{1,2}:\d{1,2}/,l=/\(([\w-]+)\)/,c=/\d{7}/;return fetch(`${n?"/picklist/view_picklist_history?picklist_id=":"/wms/view_picklist_history?picklist_id="}${e}`).then((e=>e.text())).then((e=>{const n=Array(4),s=(new DOMParser).parseFromString(e,"text/html"),d=s.querySelector(r).textContent.match(i);n[0]=d?d[0]:"-";const b=s.querySelector(o).textContent.match(i);n[1]=b?b[0]:"-";const p=s.querySelector(t).textContent.match(l);n[2]=p?p[1]:"-";const m=s.querySelector(a).textContent.match(c);return n[3]=m?m[0]:"-",n})).catch((e=>(console.log("[getPackgeInfo]Fetch error: ",e),Array(4).fill("-"))))},getTimeStyle=(e,n,t)=>{if(!e||!n)return"";const r=(t.getHours()+1)%24,o=(t.getHours()+2)%24,a=(t.getHours()+3)%24,i=parseInt(n.split(":")[0],10);return i===r?"late-window":i===o?"current-window":i===a?"next-window":""},ActionRow=({action:n,isFirstPackage:t})=>{const r=n.map(((n,t)=>3===t?e("span",{className:"monospace"},n):8===t?e("div",null,[e("span",{className:"spoo-dot"}),e("span",{className:"monospace"},n)]):9===t?e("a",{href:`/orders/view_order?id=${n}`},n):10===t?e("a",{href:`/picklist/pack_by_picklist?picklist_id=${n}`},n):n)),o="problem-solve"===r[5]?"p-solve":"",a=getTimeStyle(r[0],r[7],new Date),i=t?"table-top-border":"",l=r.map(((n,t)=>e("td",{className:"a-text-center",key:t},n)));return e("tr",{className:`${o} ${a} ${i}`},l)},mapToNewAction=(e,n)=>{const t=[];return n?(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]="",t[6]="",t[7]="",t[8]=e[9],t[9]="",t[10]=e[12],t[11]=e[11]):(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]="",t[6]="",t[7]="",t[8]=e[10],t[9]="",t[10]=e[13],t[11]=e[12]),t},MainTable=({oldTable:n,isAftlitePortal:t})=>{const[r,o]=React.useState(getActions(n).filter((e=>(e=>"pack"===e[1]&&"pack"===e[2])(e)||(e=>"indirect"===e[2])(e))).filter(((e,n,r)=>((e,n,r)=>{const o=t?e[9]:e[10],a=r.map((e=>t?e[9]:e[10]));return!o||a.indexOf(o)===n})(e,n,r))).map((e=>mapToNewAction(e,t)))),a=e(TableHeader,{titles:["Timestamp","Action","Tool","Asin","Bin","Status","Completion Time","CPT","Tote","Order","Picklist","User"],key:"main-table-header"}),i=r.map(((n,t,r)=>{const o=0===t||r[t][6]!==r[t-1][6];return e(ActionRow,{action:n,isFirstPackage:o,key:n[8]})}));return React.useEffect((()=>{r.map(((e,n)=>{const r=e[10];return r?(getPackageInfo(r,t).then((e=>{o((t=>t.map(((t,r)=>{if(r===n){const n=t.slice();return[n[6],n[7],n[5],n[9]]=e,n}return t}))))})),null):null}))}),[]),e("table",{id:"main-table",className:"a-bordered a-spacing-top-large reportLayout"},e("tbody",null,[a,...i]))},TableSwitch=({isOriginalTable:n,setIsOriginalTable:t})=>e("form",null,e("input",{type:"checkbox",checked:n,onChange:()=>t((e=>!e))})," Show original table"),App=({oldTable:n,isAftlitePortal:t})=>{const[r,o]=React.useState(!1),a=e(MainTable,{oldTable:n,isAftlitePortal:t,key:"main-table"}),i=e(TableSwitch,{isOriginalTable:r,setIsOriginalTable:o,key:"table-switch"});return React.useEffect((()=>{const e=document.querySelector("#main-content > table"),n=document.querySelector("#main-table");e.style.display=r?"table":"none",n.style.display=r?"none":"table"}),[r]),e(React.Fragment,null,[i,a])},createNewTable=()=>{const n="aftlite-portal.amazon.com"===window.location.hostname,t=document.createElement("style");t.innerText=getCSS(n),document.head.appendChild(t),n||document.querySelector("div.resultSet").setAttribute("id","main-content");const r=document.createElement("div"),o=document.querySelector("#main-content > table");o.before(r),ReactDOM.createRoot(r).render(e(App,{oldTable:o,isAftlitePortal:n}))};
