const e=React.createElement,SearchContext=React.createContext(),QRCodeContext=React.createContext();function ultimateOrderView(){if(!isVerifiedUser(getLogin()))return;const t=document.createElement("div");t.setAttribute("id","root"),document.body.insertBefore(t,document.querySelector("#orders_form")),ReactDOM.render(e(App),document.querySelector("#root")),addCSS(),document.querySelector("#search_input").focus()}function getBags(){const e=[],t=[...document.querySelectorAll("#picklists_table > tbody > tr")];t.shift();const n=t.map((e=>e.textContent.trim().split(/\s+/))),o=t.map((e=>e.querySelector("td:last-child > a")));for(let t=0;t<n.length;t+=1){const r={picker:{}};[r.id,r.zone,r.status,r.spoo,r.pickerLogin]=n[t],r.pickerUrl=`/labor_tracking/lookup_history?user_name=${r.pickerLogin}`,r.packUrl=o[t].href,r.code=getBagCode(r.spoo),r.totalItem=getBagTotalItem(r.spoo),e.push(r)}return e}function isValidCode(e){return Boolean(e.match(/[a-z,A-z,0-9]{20}/))}function getBagCode(e){if(!isValidCode(e))return"-";return[...document.querySelectorAll("a")].find((t=>t.textContent===e)).parentNode.childNodes[5].textContent.trim().split(/\s+/)[1]||"-"}function getBagTotalItem(e){if(!isValidCode(e))return"-";return[...document.querySelectorAll("a")].find((t=>t.textContent===e)).parentNode.childNodes[7].textContent.trim().split(/\s+/)[0]||"-"}function BagRow({bag:t,completionTime:n,allBags:o}){const{searchTerm:r}=React.useContext(SearchContext),{setQRCodeContent:a}=React.useContext(QRCodeContext),i=e=>{const t=("TD"===e.target.nodeName?e.target:e.target.parentNode).innerText;isValidCode(t)&&a(t)},c=isValidCode(t.code)?e("span",null,[t.code.slice(0,-4),e("b",null,t.code.slice(-4))]):t.code,l=e("a",{href:t.pickerUrl},`${t.pickerLogin}`),d=e("a",{href:t.packUrl},"Pack"),s=[e("td",null,t.id),e("td",null,t.zone),e("td",null,t.status),e("td",null,n),e("td",{onClick:i},c),e("td",{onClick:i},t.spoo),e("td",null,l),e("td",null,`${t.totalItem} items`),e("td",null,d)];let u=null;return u=isRelatedBag(t,r,o)?{className:"related-bag"}:u,u=isTargetBag(t,r)?{className:"target-bag"}:u,e("tr",u,s)}function containsKeyword(e,t){return e.indexOf(t)>-1}function isTargetBag(e,t){const n=t.toUpperCase(),o=e.code.toUpperCase(),r=e.spoo.toUpperCase();return n&&(containsKeyword(o,n)||containsKeyword(r,n))}function isRelatedBag(e,t,n){const o=n.find((e=>isTargetBag(e,t)));return!!o&&("bigs"!==o.zone&&(o.pickerLogin===e.pickerLogin&&o.zone===e.zone))}function BagTable(){const t=e("tr",null,["ID","Zone","Status","Completion Time","Tracking Code","Spoo","Picker","Total Items",""].map((t=>e("th",null,`${t}`)))),n=getBags(),[o,r]=React.useState(Array(n.length).fill("-"));React.useEffect((()=>{for(let e=0;e<n.length;e+=1){const t=n[e];fetch(`${"/wms/view_picklist_history?picklist_id="}${encodeURIComponent(t.id)}`).then((e=>e.text())).then((e=>extractCompletionTime(e))).then((t=>r((n=>[...n.slice(0,e),t,...n.slice(e+1)]))))}}),[]);const a=n.map(((t,n,r)=>e(BagRow,{bag:t,completionTime:o[n],allBags:r})));return e("table",{id:"bag-table"},[e("thead",null,t),e("tbody",null,a)])}function extractCompletionTime(e){return(new DOMParser).parseFromString(e,"text/html").querySelector("body > table:nth-child(6) > tbody > tr:nth-child(6)").textContent.match(/\d{1,2}:\d{1,2}/)||"-"}function makeQRCode(e){return new QRCode(document.querySelector("#qrcode-container"),{text:e,width:160,height:160,colorDark:"#000000",colorLight:"#ffffff",correctLevel:QRCode.CorrectLevel.H})}function QRCodeArea(){const{qrcodeContent:t}=React.useContext(QRCodeContext),n=e("div",{id:"qrcode-container"}),o=e("div",{id:"qrcode-text"},t);return e("div",{id:"qrcode-area"},[n,o])}function SearchBar(){const{searchTerm:t,setsearchTerm:n}=React.useContext(SearchContext);return e("form",null,[e("input",{id:"search_input",type:"text",placeholder:"Search by tracking-code or spoo",size:"30",value:t,onChange:e=>n(e.target.value),style:{lineHeight:"1.5rem"}})])}let qrcodeMaker=null;function UltimateTable(){const[t,n]=React.useState("");React.useEffect((()=>{t&&(null===qrcodeMaker?qrcodeMaker=makeQRCode(t):qrcodeMaker.makeCode(t))}),[t]);const o=e(BagTable),r=e(QRCodeArea),a=e("div",{id:"ultimateTable-container"},[o,r]);return e(QRCodeContext.Provider,{value:{qrcodeContent:t,setQRCodeContent:n}},a)}function App(){const[t,n]=React.useState("");return e(SearchContext.Provider,{value:{searchTerm:t,setsearchTerm:n}},[e(SearchBar),e(UltimateTable)])}function getLogin(){return document.getElementsByTagName("span")[0].innerHTML.match(/\(([^)]+)\)/)[1]}function isVerifiedUser(e){return console.log(`hello, ${e}`),!0}function addCSS(){const e=document.createElement("style");e.innerText="\n    :root,\n    body,\n    html {\n      box-sizing: border-box;\n    }\n    \n    div,\n    table,\n    thead,\n    tbody,\n    tr,\n    th,\n    td,\n    a {\n      margin: 0;\n      padding: 0;\n      border: 0;\n      outline: none;\n      font-size: 100%;\n      vertical-align: baseline;\n      background: transparent;\n    }\n    \n    #ultimateTable-container {\n      display: flex;\n      flex-wrap: wrap;\n      align-items: flex-start;\n      margin: 0.5rem 0 1rem 0;\n    }\n    \n    #bag-table {\n      flex-shrink: 0;\n      border-collapse: collapse;\n      font-family: monospace;\n      font-size: 1rem;\n      color: #101010;\n      margin-right: 1rem;\n      margin-bottom: 0.5rem;\n      border: 1px solid #888;\n      box-shadow: 0 1px 3px 0 rgb(0 0 0 / 0.1), 0 1px 2px -1px rgb(0 0 0 / 0.1);\n    }\n    \n    #bag-table th {\n      background-color: #e8e8e8;\n      padding: 0.6rem;\n      text-align: center;\n      vertical-align: middle;\n    }\n    \n    #bag-table td {\n      padding: 0.8rem 1rem;\n      text-align: center;\n      vertical-align: middle;\n    }\n    \n    #bag-table tbody tr:hover {\n      background-color: #ccc;\n    }\n    \n    #qrcode-text {\n      width: 100%;\n      font-size: 0.8rem;\n      line-height: 1.2rem;\n      text-align: center;\n      font-family: monospace;\n    }\n    \n    tr.target-bag {\n      border: 2px solid firebrick;\n      background-color: rgb(34, 77, 23, 10%) !important;\n    }\n\n    tr.related-bag {\n      background-color: rgb(34, 77, 23, 10%) !important;\n    }\n  ",document.head.appendChild(e)}
