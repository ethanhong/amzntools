const e=React.createElement;function getCSS(e){return e?"\n  :root,\n  body,\n    html {\n      box-sizing: border-box;\n    }\n    #main-table\n    {\n      margin: 0 !important;\n      padding: 0;\n      outline: none;\n      font-size: 100%;\n      vertical-align: baseline;\n      background-color: transparent;\n      white-space: nowrap;\n    }\n    #main-table tr {\n      background-color: transparent;\n    }\n    #main-table th {\n      white-space: pre-line;\n    }\n    #main-table tr:not(:first-child) {\n      border-right: 2px solid firebrick;\n      border-left: 2px solid firebrick;\n    }\n    #main-table tr:nth-last-child(1) {\n      border-bottom: 2px solid firebrick;\n    }\n    #main-table tr:hover {\n      background-color: #f6f6f6;\n    }\n    .table-top-border {\n      border-top: 2px solid firebrick;\n    }\n    .p-solve {\n      color: firebrick;\n    }\n    .monospace {\n      font-family: monospace;\n      font-size: 0.9rem;\n    }\n    .spoo-dot {\n      height: 0.5rem;\n      width: 0.5rem;\n      background-color: transparent;\n      border-radius: 50%;\n      display: inline-block;\n      margin-right: 0.2rem;\n    }\n    .late-window .spoo-dot {\n      background-color: rgb(184, 29, 19, 100%);\n    }\n    .current-window .spoo-dot {\n      background-color: rgb(239, 183, 0, 100%);\n    }\n    .next-window .spoo-dot {\n      background-color: rgb(0, 132, 80, 100%);\n    }\n  ":"\n    :root,\n    body,\n    html {\n      box-sizing: border-box;\n    }\n    #search-bar {\n      margin: 0.3rem 0rem;\n    }\n    #main-table\n    {\n      margin: 0;\n      padding: 0;\n      outline: none;\n      font-size: 100%;\n      vertical-align: baseline;\n      background-color: transparent;\n      border-collapse: collapse;\n      text-align: center;\n      white-space: nowrap;\n    }\n    #main-table tr {\n      background-color: transparent;\n      border: 1px solid #f6f6f6;\n    }\n    #main-table th {\n      white-space: pre-line;\n    }\n    #main-table tr:not(:first-child) {\n      border-right: 2px solid firebrick;\n      border-left: 2px solid firebrick;\n    }\n    #main-table tr:nth-last-child(1) {\n      border-bottom: 2px solid firebrick;\n    }\n    #main-table tr:hover {\n      background-color: #f6f6f6;\n    }\n    .table-top-border {\n      border-top: 2px solid firebrick !important;\n    }\n    .p-solve {\n      color: firebrick;\n    }\n    .monospace {\n      font-family: monospace;\n      font-size: 0.9rem;\n    }\n    .spoo-dot {\n      height: 0.5rem;\n      width: 0.5rem;\n      background-color: transparent;\n      border-radius: 50%;\n      display: inline-block;\n      margin-right: 0.2rem;\n    }\n    .late-window .spoo-dot {\n      background-color: rgb(184, 29, 19, 100%);\n    }\n    .current-window .spoo-dot {\n      background-color: rgb(239, 183, 0, 100%);\n    }\n    .next-window .spoo-dot {\n      background-color: rgb(0, 132, 80, 100%);\n    }\n  "}function getActions(e){const[,...t]=[...e.querySelectorAll("tbody > tr")];return t.map((e=>[...e.querySelectorAll("td")].map((e=>e.textContent.trim()))))}function TableHeader({titles:t}){const n=t.map((t=>e("th",{className:"a-text-center",key:t},t)));return e("tr",null,n)}async function getPackageInfo(e,t){const n=t?"/picklist/view_picklist_history?picklist_id=":"/wms/view_picklist_history?picklist_id=",r=t?"div.a-row:nth-child(6)":"table:nth-child(6) tr:nth-child(2)",o=t?"div.a-row:nth-child(10)":"tr:nth-child(6)",i=t?"div.a-row:nth-child(12)":"tr:nth-child(8)",a=t?"div.a-row:nth-child(2)":"tr:nth-child(2)",c=/\d{1,2}:\d{1,2}/,l=/\(([\w-]+)\)/,s=/\d{7}/;try{const t=await fetch(`${n}${e}`),d=await t.text(),b=(new DOMParser).parseFromString(d,"text/html"),u=[],p=b.querySelector(o).textContent.match(c);u[0]=p?p[0]:"-";const m=b.querySelector(i).textContent.match(c);u[1]=m?m[0]:"-";const f=b.querySelector(r).textContent.match(l);u[2]=f?f[1]:"-";const h=b.querySelector(a).textContent.match(s);return u[3]=h?h[0]:"-",u}catch(e){return console.log("[getPackgeInfo]Fetch error: ",e),Array(4).fill("-")}}function getTimeStyle(e,t,n){if(!e||!t)return"";const r=(n.getHours()+1)%24,o=(n.getHours()+2)%24,i=(n.getHours()+3)%24,a=parseInt(t.split(":")[0],10);return a===r?"late-window":a===o?"current-window":a===i?"next-window":""}function ActionRow({action:t,isFirstPackage:n,isAftlitePortal:r}){const o=r?"/orders/view_order?id=":"/wms/view_order/",i=r?"/picklist/pack_by_picklist?picklist_id=":"/wms/pack_by_picklist?picklist_id=",a=t.map(((t,n)=>3===n?e("span",{className:"monospace"},t):8===n?e("div",null,[e("span",{className:"spoo-dot"}),e("span",{className:"monospace"},t)]):9===n?e("a",{href:`${o}${t}`},t):10===n?e("a",{href:`${i}${t}`},t):t)),c="problem-solve"===a[5]?"p-solve":"",l=getTimeStyle(a[0],a[7],new Date),s=n?"table-top-border":"",d=a.map(((t,n)=>e("td",{className:"a-text-center",key:n},t)));return e("tr",{className:`${c} ${l} ${s}`},d)}function mapToNewAction(e){return t=>{const n=[];return e?(n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[3],n[4]=t[4],n[5]="",n[6]="",n[7]="",n[8]=t[9],n[9]="",n[10]=t[12],n[11]=t[11]):(n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[3],n[4]=t[4],n[5]="",n[6]="",n[7]="",n[8]=t[10],n[9]="",n[10]=t[13],n[11]=t[12]),n}}async function doSerialRecursion(e,t,n){if(!e[n])return[];return[await t(e[n],n,e),...await doSerialRecursion(e,t,n+1)]}async function fetchTrackCode(e,t,n){const r=n?"/orders/view_order?id=":"/wms/view_order/";return(await doSerialRecursion(e,(async(n,o)=>{const i=`${r}${n[9]}`,a=n[8],[c]=await fetch(i).then((e=>e.text())).then((e=>e.slice(e.indexOf(a)+20,e.indexOf(a)+80).match(/[\w\d]{20}/)||[])),l=(o+1)/e.length*100;return t(l%100?l.toFixed(1):l),c}),0)).filter((e=>Boolean(e)))}function getActionToFetch(e){const t=getActions(document.querySelector("#main-table")),n=t=>t[8]===e,[r]=t.filter(n),o=t.filter((e=>e[6]===r[6]&&e[7]===r[7])).filter((e=>!n(e)));return[r,...o]}function SearchBar({isAftlitePortal:t}){const[n,r]=React.useState(0),o=React.useRef(null),i=React.useRef(null),a=e("form",{id:"search-form"},[e("input",{id:"search-input",type:"text",placeholder:"Search bags ...",size:"30",ref:o}),e("input",{id:"search-btn",type:"button",value:"Search",onClick:async()=>{if(!o.current.value)return;i.current.disabled=!0;const e=getActionToFetch(o.current.value),n=await fetchTrackCode(e,r,t);i.current.disabled=!1,n.length<=1?alert("No related bags found."):setTimeout((()=>{prompt(`Found ${n.length-1} related bags.\nCopy and paste the relust into COMO for locations.`,n),r(0)}),100)},ref:i}),` ( ${n} % )`]);return e("div",{id:"search-bar"},[a])}function MainTable({oldTable:t,isAftlitePortal:n}){const[r,o]=React.useState(getActions(t).filter((e=>(e=>"pack"===e[1])(e)||(e=>"indirect"===e[2])(e))).filter(((e,t,r)=>{const o=n?9:10,i=r.find((t=>t[o]===e[o]));return!i[o]||i===e})).map(mapToNewAction(n))),i=e(TableHeader,{titles:["Timestamp","Action","Tool","Asin","Bin","Status","Completion Time","CPT","Tote","Order","Picklist","User"],key:"main-table-header"}),a=r.map(((t,r,o)=>{const i=!r||o[r][6]!==o[r-1][6];return e(ActionRow,{action:t,isFirstPackage:i,isAftlitePortal:n,key:t[8]})}));React.useEffect((()=>{r.map((async(e,t)=>{const{10:r}=e;if(!r)return;const i=await getPackageInfo(r,n);o((e=>{const n=[...e[t]];return[n[6],n[7],n[5],n[9]]=i,[...e.slice(0,t),n,...e.slice(t+1)]}))}))}),[]);const c=e(SearchBar,{isAftlitePortal:n,key:"search-bar"}),l=e("table",{id:"main-table",className:"a-bordered a-spacing-top-large reportLayout"},e("tbody",null,[i,...a]));return e("div",null,[c,l])}function TableSwitch({isOriginalTable:t,setIsOriginalTable:n}){return e("form",null,[e("input",{type:"checkbox",checked:t,onChange:()=>n((e=>!e))})," Show original table"])}function App({oldTable:t,isAftlitePortal:n}){const[r,o]=React.useState(!1),i=e(MainTable,{oldTable:t,isAftlitePortal:n,key:"main-table"}),a=e(TableSwitch,{isOriginalTable:r,setIsOriginalTable:o,key:"table-switch"});return React.useEffect((()=>{const e=document.querySelector("#main-content > table"),t=document.querySelector("#main-table");e.style.display=r?"table":"none",t.style.display=r?"none":"table"}),[r]),e(React.Fragment,null,[a,i])}function startBagFinder(){const t="aftlite-portal.amazon.com"===window.location.hostname,n=document.createElement("style");n.innerText=getCSS(t),document.head.appendChild(n),t||document.querySelector("div.resultSet").setAttribute("id","main-content");const r=document.createElement("div"),o=document.querySelector("#main-content > table");o.before(r),ReactDOM.createRoot(r).render(e(App,{oldTable:o,isAftlitePortal:t}))}
